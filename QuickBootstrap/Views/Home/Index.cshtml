@using QuickBootstrap.Entities
@using QuickBootstrap.Extendsions
@{
    ViewBag.Title = "平台概况";
}

<div class="content">
    <div class="container">

        <form class="form-inline">
            <div class="form-group">
                <label class="sr-only" for="exampleInputEmail3">Email address</label>
                <input type="text" class="form-control form_date" id="exampleInputEmail3" placeholder="开始时间">
            </div>
            <div class="form-group">
                <label class="sr-only" for="exampleInputPassword3">Password</label>
                <input type="text" class="form-control form_date" id="exampleInputPassword3" placeholder="结束时间">
            </div>
            <div class="form-group">
                <label class="control-label" for="M_id">广告主</label>
                <input type="text" class="form-control" id="M_id" placeholder="广告主">
            </div>

            <button type="submit" class="btn btn-default">Sign in</button>
        </form>

        <div class="bootstrap-table">
            <table id="table"></table>
        </div>
        <div class="clearfix"></div>
    </div>

</div>

<script type="text/javascript">
    
    $('.form_date').datetimepicker({
        format: 'yyyy-mm-dd',
        language: 'zh-CN',
        autoclose:true,
        weekStart: 1,
        todayBtn: 1,
        autoclose: 1,
        todayHighlight: 1,
        startView: 2,
        minView: 2,
        forceParse: 0,
        initialDate:'2015-09-09'
    });

    $(document).ready(function () {
        $('#table').bootstrapTable({
            locale: 'zh-CN',
            cahce: false,
            method: 'get',                          // 远程获取数据的方式
            url: "api/data/SalesData",
            height: $(window).height() -20,         // 表格的高度
            striped: true,                          // 条纹状
            dataType: "json",                       // 你希望服务端返回你的数据类型
            pagination: true,                       // 是否显示分页toolbar
            queryParamsType: 'limit',               // 设置为limit 则是restful 风格查询参数
            singleSelect: false,                    // 单行选择
          //  contentType: "application/x-www-form-urlencoded",
            pageSize: 10,
            pageNumber: 1,
          //  search: true,                              //是否显示 搜索框
            searchAlign:'right',
            showColumns: true,                         //是否显示下拉框（选择显示的列）
            sidePagination: "server",                  //定义服务端分页
          //  queryParams: queryParams,
          //minimunCountColumns: 2,
            responseHandler: responseHandler,
          //  searchText:'',
            //  multipleSearch: false,
            toolbar: '.form_date',
            showFilter:true,

            filterControl: true,
            filterShowClear: true,

            columns: [
                { field: 'GenerationTime', title: '产生时间', formatter: function (value) { return new Date(value).format('yyyy.MM.dd hh:mm:ss') } },
                { field: 'M_id', title: '广告主', width: 100, align: 'center', valign: 'middle', sortable: false },
                { field: 'Affiliate_id', title: '网站编号', width: 100, align: 'center', valign: 'middle', sortable: false },
                 
                { field: 'O_cd', title: '订单号', width: 100, align: 'center', valign: 'middle', sortable: false },
                { field: 'P_cd', title: '商品编号', width: 100, align: 'center', valign: 'middle', sortable: false },
                { field: 'C_cd', title: '分类', width: 100, align: 'center', valign: 'middle', sortable: false },
                { field: 'It_cnt', title: '个数', width: 100, align: 'center', valign: 'middle', sortable: false },
                { field: 'Price', title: '单价', width: 100, align: 'center', valign: 'middle', sortable: false },
                { field: 'Sales', title: '销售额', width: 100, align: 'center', valign: 'middle', sortable: false },

                { field: 'Comm', title: '佣金', width: 100, align: 'center', valign: 'middle', sortable: false },
                { field: 'Stat_code', title: '业绩状态', filterControl:'select',width: 100, align: 'center', valign: 'middle', sortable: false },
                { field: 'U_id', title: 'U_ID', width: 100, align: 'center', valign: 'middle', sortable: false },
                { field: 'Bill_yyyymmdd', title: '结算时间', width: 100, align: 'center', valign: 'middle', sortable: false },
            ]
        });

    });
    function responseHandler(res) {
        if (res.IsOk) {
           // var resultStr = $.parseJSON(res);
            return {
                "rows": res.Result,
                "total": res.Count
            };

        } else {
            return {
                "rows": [],
                "total": 0
            };
        }

    }

    Date.prototype.format = function (format) {
        var o = {
            "M+": this.getMonth() + 1, //month
            "d+": this.getDate(),    //day
            "h+": this.getHours(),   //hour
            "m+": this.getMinutes(), //minute
            "s+": this.getSeconds(), //second
            "q+": Math.floor((this.getMonth() + 3) / 3),  //quarter
            "S": this.getMilliseconds() //millisecond
        }
        if (/(y+)/.test(format)) format = format.replace(RegExp.$1,
        (this.getFullYear() + "").substr(4 - RegExp.$1.length));
        for (var k in o) if (new RegExp("(" + k + ")").test(format))
            format = format.replace(RegExp.$1,
            RegExp.$1.length == 1 ? o[k] :
            ("00" + o[k]).substr(("" + o[k]).length));
        return format;
    }

    //传递的参数，已经是limit，params 是特地的5个【limit, offset, search, sort, order】属性组成的查询对象，你可以对查询对象进行属性操作，也可以不使用params对象，自己决定查询参数
    function queryParams(params) {
        //return {
        //    pageSize: params.limit,
        //    pageNumber: params.pageNumber,
        //};
            params.pageSize = params.limit;
            params.search = params.search;
            return params;
    }

</script>
