@using QuickBootstrap.Entities
@using QuickBootstrap.Extendsions
@{
    ViewBag.Title = "平台概况";
}
<div class="content">
    <div class="container">
        <h1> 业务报表</h1>
        <form class="form-inline" role="form">

            <div class="form-group">
                <label for="dtp_input2" class="col-md-2 sr-only">Date Picking</label>
                <div class="input-group date form_date col-md-3" data-date="" data-date-format="dd MM yyyy" data-link-field="dtp_input2" data-link-format="yyyy-mm-dd">
                    <input class="form-control" size="16" type="text" value="" readonly="">
                    <span class="input-group-addon"><span class="glyphicon glyphicon-remove"></span></span>
                    <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>
                </div>
                <input type="hidden" id="dtp_input1" value=""><br>
            </div>

            <div class="form-group">
                <label for="dtp_input2" class="col-md-2 sr-only">Date Picking</label>
                <div class="input-group date form_date col-md-3" data-date="" data-date-format="dd MM yyyy" data-link-field="dtp_input2" data-link-format="yyyy-mm-dd">
                    <input class="form-control" size="16" type="text" value="" readonly="">
                    <span class="input-group-addon"><span class="glyphicon glyphicon-remove"></span></span>
                    <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>
                </div>
                <input type="hidden" id="dtp_input2" value=""><br>
            </div>


            <select class="form-group">
                <option>订单编号</option>
                <option>商品编号</option>
                <option>网站编号</option>
            </select>

            <div class="form-group">
                <label class="sr-only" for="exampleInputEmail2">邮箱</label>
                <input type="email" class="form-control" id="exampleInputEmail2" placeholder="请输入你的邮箱地址" />
            </div>
            <div class="form-group">
                <label class="sr-only" for="exampleInputPassword2">密码</label>
                <input type="password" class="form-control" id="exampleInputPassword2" placeholder="请输入你的邮箱密码"/>
            </div>

            <button type="submit" class="btn btn-default">Send invitation</button>

        </form>


        <div class="bootstrap-table">
            <table id="table"></table>
        </div>
        <div class="clearfix"></div>
    </div>
</div>
<script type="text/javascript">
    
    $('.form_date').datetimepicker({
        format: 'yyyy-mm-dd',
        language: 'zh-CN',
        autoclose: true,
        weekStart: 1,
        todayBtn: 1,
        autoclose: 1,
        todayHighlight: 1,
        startView: 2,
        minView: 2,
        forceParse: 0
    });

    $(document).ready(function () {
        $('#table').bootstrapTable({
            locale: 'zh-CN',
            cahce: false,
            method: 'get',                          // 远程获取数据的方式
            url: "api/data/SalesData",
            height: $(window).height() - 20,         // 表格的高度
            striped: true,                          // 条纹状
            dataType: "json",                       // 你希望服务端返回你的数据类型
            pagination: true,                       // 是否显示分页toolbar
            queryParamsType: 'limit',               // 设置为limit 则是restful 风格查询参数
            singleSelect: false,                    // 单行选择
            //  contentType: "application/x-www-form-urlencoded",
            pageSize: 10,
            pageNumber: 1,
            //  search: true,                              //是否显示 搜索框
            searchAlign: 'right',
            showColumns: true,                         //是否显示下拉框（选择显示的列）
            sidePagination: "server",                  //定义服务端分页
            //  queryParams: queryParams,
            //minimunCountColumns: 2,
            responseHandler: responseHandler,
            //  searchText:'',
            //  multipleSearch: false,
           // toolbar: '.form_date',
           // showFilter: true,

            // filterControl: true,
            //   filterShowClear: true,

            columns: [
                { field: 'GenerationTime', title: '产生时间', formatter: function (value) { return new Date(value).format('yyyy.MM.dd hh:mm:ss') } },
                { field: 'M_id', title: '广告主', width: 100, align: 'center', valign: 'middle', sortable: false },
                { field: 'Affiliate_id', title: '网站编号', width: 100, align: 'center', valign: 'middle', sortable: false },

                { field: 'O_cd', title: '订单号', width: 100, align: 'center', valign: 'middle', sortable: false },
                { field: 'P_cd', title: '商品编号', width: 100, align: 'center', valign: 'middle', sortable: false },
                { field: 'C_cd', title: '分类', width: 100, align: 'center', valign: 'middle', sortable: false },
                { field: 'It_cnt', title: '个数', width: 100, align: 'center', valign: 'middle', sortable: false },
                { field: 'Price', title: '单价', width: 100, align: 'center', valign: 'middle', sortable: false },
                { field: 'Sales', title: '销售额', width: 100, align: 'center', valign: 'middle', sortable: false },

                { field: 'Comm', title: '佣金', width: 100, align: 'center', valign: 'middle', sortable: false },
                { field: 'Stat_code', title: '业绩状态', filterControl: 'select', width: 100, align: 'center', valign: 'middle', sortable: false },
                { field: 'U_id', title: 'U_ID', width: 100, align: 'center', valign: 'middle', sortable: false },
                { field: 'Bill_yyyymmdd', title: '结算时间', width: 100, align: 'center', valign: 'middle', sortable: false },
            ]
        });

    });
    function responseHandler(res) {
        if (res.IsOk) {
            // var resultStr = $.parseJSON(res);
            return {
                "rows": res.Result,
                "total": res.Count
            };

        } else {
            return {
                "rows": [],
                "total": 0
            };
        }

    }

    Date.prototype.format = function (format) {
        var o = {
            "M+": this.getMonth() + 1, //month
            "d+": this.getDate(),    //day
            "h+": this.getHours(),   //hour
            "m+": this.getMinutes(), //minute
            "s+": this.getSeconds(), //second
            "q+": Math.floor((this.getMonth() + 3) / 3),  //quarter
            "S": this.getMilliseconds() //millisecond
        }
        if (/(y+)/.test(format)) format = format.replace(RegExp.$1,
        (this.getFullYear() + "").substr(4 - RegExp.$1.length));
        for (var k in o) if (new RegExp("(" + k + ")").test(format))
            format = format.replace(RegExp.$1,
                RegExp.$1.length == 1 ? o[k] :
                ("00" + o[k]).substr(("" + o[k]).length));
        return format;
    }

    //传递的参数，已经是limit，params 是特地的5个【limit, offset, search, sort, order】属性组成的查询对象，你可以对查询对象进行属性操作，也可以不使用params对象，自己决定查询参数
    function queryParams(params) {
        //return {
        //    pageSize: params.limit,
        //    pageNumber: params.pageNumber,
        //};
        params.pageSize = params.limit;
        params.search = params.search;
        return params;
    }

</script>
