@using QuickBootstrap.Entities
@using QuickBootstrap.Extendsions
@{
    ViewBag.Title = "平台概况";
}

<div class="content">
    <div class="container">
        <h1>
            业绩报告
        </h1>

        <div class="bootstrap-table">
            <table id="table"></table>

        </div>
        <div class="clearfix"></div>
    </div>

</div>

<script type="text/javascript">
    
    $(document).ready(function () {
        $('#table').bootstrapTable({
            locale: 'fr-CA',
            method: 'post',             // 远程获取数据的方式
            url: "api/data/SalesData",
            height: $(window).height() -20,       // 表格的高度
            striped: true,                          // 条纹状
            dataType: "json",                       // 你希望服务端返回你的数据类型
            pagination: true,                       // 是否显示分页toolbar
            queryParamsType: 'limit',               // limit restful 风格查询参数
            singleSelect: false,                    // 单行选择
          //  contentType: "application/x-www-form-urlencoded",
            pageSize: 10,
            pageNumber: 1,
            search: true,                               //不显示 搜索框
            showColumns: true,                         //不显示下拉框（选择显示的列）
            sidePagination: "server",                   //定义服务端分页
            queryParams: queryParams,
            //minimunCountColumns: 2,
            responseHandler: responseHandler,
            columns: [
                { field: 'GenerationTime', title: '产生时间', formatter: function (value, row, index) { return new Date(value).format('yyyy-MM-dd hh:mm:ss') } },
                { field: 'M_id', title: '广告主', width: 100, align: 'center', valign: 'middle', sortable: false },
                { field: 'Affiliate_id', title: '网站编号', width: 100, align: 'center', valign: 'middle', sortable: false },
                 
                { field: 'O_cd', title: '订单号', width: 100, align: 'center', valign: 'middle', sortable: false },
                { field: 'P_cd', title: '商品编号', width: 100, align: 'center', valign: 'middle', sortable: false },
                { field: 'C_cd', title: '分类', width: 100, align: 'center', valign: 'middle', sortable: false },
                { field: 'It_cnt', title: '个数', width: 100, align: 'center', valign: 'middle', sortable: false },
                { field: 'Price', title: '单价', width: 100, align: 'center', valign: 'middle', sortable: false },
                { field: 'Sales', title: '销售额', width: 100, align: 'center', valign: 'middle', sortable: false },

                { field: 'Comm', title: '佣金', width: 100, align: 'center', valign: 'middle', sortable: false },
                { field: 'Stat_code', title: '业绩状态', width: 100, align: 'center', valign: 'middle', sortable: false },
                { field: 'U_id', title: 'U_ID', width: 100, align: 'center', valign: 'middle', sortable: false },
                { field: 'Bill_yyyymmdd', title: '结算时间', width: 100, align: 'center', valign: 'middle', sortable: false },
            ]
        });

    });
    function responseHandler(res) {
        if (res.IsOk) {
           // var resultStr = $.parseJSON(res);
            return {
                "rows": res.Result,
                "total": res.Count
            };

        } else {
            return {
                "rows": [],
                "total": 0
            };
        }

    }

    Date.prototype.format = function (format) {
        var o = {
            "M+": this.getMonth() + 1, //month
            "d+": this.getDate(),    //day
            "h+": this.getHours(),   //hour
            "m+": this.getMinutes(), //minute
            "s+": this.getSeconds(), //second
            "q+": Math.floor((this.getMonth() + 3) / 3),  //quarter
            "S": this.getMilliseconds() //millisecond
        }
        if (/(y+)/.test(format)) format = format.replace(RegExp.$1,
        (this.getFullYear() + "").substr(4 - RegExp.$1.length));
        for (var k in o) if (new RegExp("(" + k + ")").test(format))
            format = format.replace(RegExp.$1,
            RegExp.$1.length == 1 ? o[k] :
            ("00" + o[k]).substr(("" + o[k]).length));
        return format;
    }

    //传递的参数，已经是limit，params 是特地的5个【limit, offset, search, sort, order】属性组成的查询对象，你可以对查询对象进行属性操作，也可以不使用params对象，自己决定查询参数
    function queryParams(params) {
        return {
            pageSize: params.limit,
            pageNumber: params.pageNumber,

            // 可以传入用户标识，决定数据查看权限
            UserName: 4

        };

    }
</script>
